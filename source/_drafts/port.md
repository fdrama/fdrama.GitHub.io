---
title: 重新认识端口
date: 2023-05-29 17:33:53
tags: [http, port]
categories: HTTP
---

在我们日常开发中，见过各种端口，这个东西无处不在。在本地 web 开发调试过程中, 我们可能都碰到过端口, 比如最著名的`8080`端口, 一般我们会这样去访问本地的`web`程序:

```url
localhost:8080
```

那么端口是做什么的，端口是必须的吗。

## 什么是端口

> 端口是计算机用于标识网络应用程序的一种**逻辑地址**，它是一个`16`位的数字，范围为[0,65535]。端口的作用是将网络通信分成多个独立的通道，每个通道都有自己的端口号。

每个端口都会与主机的IP地址关联，我们知道可以通过IP地址定位到服务器，但是只知道服务器地址，是没办法处理网络请求的，还需要调用服务器上的进程处理，这里就需要通过`端口`来实现。

那么为什么需要端口，而不是直接访问进程ID呢，主要有以下原因：

1. 客户端不知道服务器的进程ID
2. 重启进程，进程ID会发生变化
3. 服务器的进程ID不是固定的

这就引入了端口这个**间接层**，客户端不需要知道服务端的进程ID，直接访问固定的端口，服务端进程去监听对应端口的通讯并处理。

我们现在来看一个简单的访问网站的处理过程：

例如 `https://www.zhihu.com/`

a. 浏览器从URL中通过DNS解析出服务器的主机名`www.zhihu.com`；
b. 浏览器通过DNS服务将主机名转换成服务器的IP；
c. 浏览器将端口(如果没有就是默认端口)，从URL中解析出来；
d. 浏览器建立一条与Web服务器的TCP连接；
e. 浏览器向服务器发送一条HTTP请求报文；
f. 服务器向浏览器推送一条HTTP响应报文；
g. 关闭连接，浏览器渲染文档；

## 常见端口

端口的大小由于是用16位二进制表示，所以大小为 `0~65535`；在TCP协议中，端口号0是被保留的，不可使用。`1~1023` 系统保留，只能由root用户使用。`1024~4999` 由客户端程序自由分配。`5000~65535` 由服务器端程序自由分配。在UDP协议中，来源端口号是可以选择要不要填上，如果设为0，则代表没有来源端口号。

又由于考虑用户使用，很多协议都使用的缺省端口，即不指定端口则使用默认端口。

80：HTTP 协议的默认端口，用于提供 Web 网站的访问服务。

443：HTTPS 协议的默认端口，用于提供安全的 Web 网站的访问服务。

110：POP3 协议的默认端口，用于接收电子邮件。

143：IMAP 协议的默认端口，用于接收电子邮件。

21：FTP 协议的默认端口，用于文件传输。

22：SSH 协议的默认端口，用于远程登录和文件传输。

23：Telnet 协议的默认端口，用于远程登录。

25：SMTP 协议的默认端口，用于发送电子邮件。

53：DNS 协议的默认端口，用于域名解析。

## 存储文件

- linux: /etc/services
- windows: C:\Windows\system32\drivers\etc\services

## 查看端口占用情况

```bash
sudo lsof -i :端口号 #linux
netstat -aon|findstr "8081" #windows
```